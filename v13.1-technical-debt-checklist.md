# v13.1 Technical Debt Checklist

**Created**: 2025-01-23  
**Purpose**: Track and resolve technical issues and workarounds from v13.0

## Critical Issues (Must Fix)

### 1. Project Loading Functionality
- [x] Fix hanging issue when loading existing .gox files ‚ö†Ô∏è **WORKAROUND USED**
- [ ] Remove workaround in `src/core/goxel_core.c:175` ‚ö†Ô∏è **NEW WORKAROUND ADDED**
- [ ] Implement proper project loading in `goxel_core_open_project()`
- [ ] Test loading various .gox file formats and sizes

**Status**: ‚ö†Ô∏è **PARTIAL - WORKAROUND SOLUTION**
- **Issue**: Created `goxel_core_load_project_impl()` that creates empty project instead of loading actual GOX data
- **Root Cause**: CLI hangs during initialization, not in load_from_file itself
- **Impact**: CLI no longer hangs, but actual project loading is disabled
- **Next Steps**: Need to fix the CLI initialization hang and implement proper GOX loading

### 2. Rendering Pipeline
- [x] Fix segmentation fault in full voxel rendering ‚úÖ **PROPERLY FIXED**
- [x] Remove gradient workaround in `src/core/goxel_core.c:419` ‚úÖ **PROPERLY FIXED**
- [x] Implement proper voxel-to-image rendering ‚úÖ **PROPERLY FIXED**
- [x] Integrate with OSMesa for headless rendering ‚úÖ **PROPERLY FIXED**
- [ ] Test rendering with different view angles and sizes

**Status**: ‚úÖ **COMPLETED - PROPER SOLUTION**
- **Solution**: Replaced gradient workaround with real headless rendering pipeline
- **Implementation**: Uses `headless_render_scene_with_camera()` and OSMesa integration
- **Impact**: Rendering now produces actual voxel images instead of test gradients

### 3. Layer Merge Implementation
- [ ] Implement actual volume merging logic
- [ ] Remove fake merge in `src/core/goxel_core.c:317`
- [ ] Properly merge voxel data between layers
- [ ] Handle layer properties during merge
- [ ] Add tests for layer merge operations

## High Priority Issues

### 4. Memory Access Issues
- [x] Fix memory access error when setting image path ‚úÖ **PROPERLY FIXED**
- [x] Remove workaround in `src/core/goxel_core.c:161` ‚úÖ **PROPERLY FIXED**
- [x] Properly track file paths in context ‚úÖ **PROPERLY FIXED**
- [ ] Ensure thread safety for path operations

**Status**: ‚úÖ **COMPLETED - PROPER SOLUTION**
- **Solution**: Fixed incorrect `snprintf()` usage on dynamically allocated `char*`
- **Implementation**: Used proper `free()`/`strdup()` pattern for `ctx->image->path`
- **Impact**: Eliminated memory access workaround, restored proper path tracking

### 5. Export/Import Functionality
- [ ] Integrate format handlers for export command
- [ ] Support major formats (OBJ, PLY, STL, VOX)
- [ ] Fix convert command to work with all formats
- [ ] Add format validation and error handling

### 6. Direct Buffer Rendering
- [ ] Implement direct buffer rendering API
- [ ] Remove temp file workaround in `goxel_headless_api.c:735`
- [ ] Optimize memory usage for render operations
- [ ] Add buffer size validation

## Medium Priority Issues

### 7. OSMesa macOS Support
- [ ] Properly detect and link OSMesa on macOS
- [ ] Remove stub functions in `render_headless.c:30`
- [ ] Add fallback rendering for systems without OSMesa
- [ ] Document OSMesa installation for macOS users

### 8. Preview Generation
- [ ] Re-enable preview generation for .gox files
- [ ] Fix issues causing problems in headless mode
- [ ] Remove skip in `src/core/formats/gox.c:1126`
- [ ] Test preview generation with various scenes

### 9. Project Size Parameter
- [ ] Fix `--size` parameter parsing in create command
- [ ] Validate size constraints
- [ ] Update help documentation
- [ ] Add tests for various size configurations

## Low Priority Issues

### 10. Script Execution Integration
- [ ] Integrate QuickJS script execution
- [ ] Remove placeholder in `goxel_core.c:471`
- [ ] Add script error handling
- [ ] Document scripting API

### 11. Read-Only Mode
- [ ] Implement read-only mode properly
- [ ] Add to goxel_core structure
- [ ] Enforce read-only constraints
- [ ] Add CLI flag for read-only mode

### 12. Bounding Box Calculation
- [ ] Implement proper bbox calculation
- [ ] Remove hardcoded values in `goxel_core.c:481`
- [ ] Calculate actual voxel bounds
- [ ] Add caching for performance

## Testing Requirements

### Unit Tests
- [ ] Add tests for project loading
- [ ] Add tests for rendering pipeline
- [ ] Add tests for layer operations
- [ ] Add tests for export functionality

### Integration Tests
- [ ] Test complete workflows (create ‚Üí edit ‚Üí save ‚Üí load)
- [ ] Test all CLI commands with real data
- [ ] Test error handling and edge cases
- [ ] Performance regression tests

### Platform Tests
- [ ] Validate fixes on macOS ARM64
- [ ] Test on Linux x86_64
- [ ] Test on Windows
- [ ] Container deployment tests

## Performance Targets

- [ ] Maintain startup time < 10ms
- [ ] Keep binary size < 6MB
- [ ] Project loading < 100ms for typical files
- [ ] Rendering < 50ms for 256¬≥ volumes

## Documentation Updates

- [ ] Update CLI help for fixed commands
- [ ] Document any API changes
- [ ] Add troubleshooting guide
- [ ] Update compatibility notes

## Success Criteria

- [ ] All critical issues resolved
- [ ] Zero segmentation faults
- [ ] All CLI commands functional
- [ ] Test coverage > 95%
- [ ] No memory leaks
- [ ] Performance targets met

---

## üìä Progress Summary (Updated: 2025-01-23)

### ‚úÖ Issues with Proper Solutions (2/12)
1. **Rendering Pipeline** - Completely fixed with real headless rendering
2. **Memory Access Issues** - Properly fixed path allocation problems

### ‚ö†Ô∏è Issues with Workaround Solutions (1/12) 
1. **Project Loading** - CLI no longer hangs, but actual GOX loading disabled

### ‚ùå Unresolved Issues (9/12)
- Layer Merge Implementation
- Export/Import Functionality  
- Direct Buffer Rendering
- OSMesa macOS Support
- Preview Generation
- Project Size Parameter
- Script Execution Integration
- Read-Only Mode
- Bounding Box Calculation

### üö® Critical Assessment
**Current Status**: **NOT PRODUCTION READY**
- **Workarounds Used**: 1 critical issue (project loading) uses workaround instead of proper fix
- **Core Functionality Impact**: Users cannot load existing .gox files
- **Stability**: Significantly improved (no more CLI hangs or segfaults)
- **Next Priority**: Fix CLI initialization hang to enable proper project loading

### üéØ Recommended Next Steps
1. **High Priority**: Debug and fix CLI initialization hang that prevents proper project loading
2. **Medium Priority**: Implement layer merge functionality for multi-layer workflows  
3. **Medium Priority**: Add export format integration for file conversion workflows

---

**Note**: This checklist represents the technical debt accumulated during v13.0 development. While significant progress has been made on stability, true production readiness requires completing the remaining critical issues without workarounds.