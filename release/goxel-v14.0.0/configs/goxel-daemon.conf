# Goxel Daemon Configuration
# Version 14.0.0
#
# This file configures the Goxel daemon service.
# All settings can be overridden via environment variables
# using the format: GOXEL_<SECTION>_<KEY>=value

daemon:
  # Socket configuration
  socket_path: /var/run/goxel/goxel.sock
  socket_permissions: 0660
  socket_backlog: 128
  
  # TCP configuration (optional, disabled by default)
  # tcp_enabled: false
  # tcp_host: 127.0.0.1
  # tcp_port: 7890
  
  # Process settings
  pid_file: /var/run/goxel/goxel.pid
  working_directory: /var/lib/goxel
  umask: 0002
  
  # Worker pool configuration
  worker_threads: 4           # Number of worker threads (0 = auto-detect)
  request_queue_size: 1000    # Maximum queued requests
  request_timeout: 30000      # Request timeout in milliseconds
  
  # Client limits
  max_clients: 100           # Maximum concurrent connections
  client_timeout: 300000     # Client idle timeout (5 minutes)
  max_request_size: 10485760 # Maximum request size (10MB)
  
  # Performance tuning
  batch_size: 50             # Max requests per batch
  keepalive_interval: 60     # Keepalive interval in seconds
  gc_interval: 300           # Garbage collection interval

logging:
  # Logging configuration
  enable_logging: true
  log_level: info            # debug, info, warn, error
  log_file: /var/log/goxel/daemon.log
  log_max_size: 10485760     # 10MB
  log_max_files: 5           # Number of rotated files to keep
  log_format: json           # json or text
  
  # Performance logging
  enable_metrics: true
  metrics_interval: 60       # Log metrics every N seconds
  
  # Request logging
  log_requests: false        # Log all RPC requests (verbose)
  log_slow_requests: true    # Log requests slower than threshold
  slow_request_threshold: 1000  # Milliseconds

security:
  # Authentication (disabled by default)
  enable_auth: false
  # auth_token: ""           # Shared secret for authentication
  # auth_timeout: 3600       # Auth token validity in seconds
  
  # Access control
  allowed_users: []          # Empty = all users (socket permissions apply)
  allowed_groups: [goxel]    # Groups allowed to connect
  
  # Rate limiting
  enable_rate_limit: true
  rate_limit_requests: 1000  # Max requests per minute per client
  rate_limit_burst: 100      # Burst allowance

resource_limits:
  # Memory limits
  max_memory_usage: 536870912  # 512MB
  memory_warning_threshold: 0.8 # Warn at 80% usage
  
  # CPU limits  
  cpu_affinity: []           # CPU cores to bind to (empty = no binding)
  nice_level: 10             # Process nice level
  
  # File limits
  max_open_files: 65536      # Maximum file descriptors

monitoring:
  # Health check endpoint
  health_check_enabled: true
  health_check_interval: 10  # Seconds between internal checks
  
  # Metrics export
  metrics_enabled: true
  # prometheus_enabled: false
  # prometheus_port: 9090
  
  # Status reporting
  status_file: /var/run/goxel/daemon.status
  status_update_interval: 5  # Seconds

advanced:
  # Advanced tuning (rarely needs changing)
  socket_buffer_size: 65536  # Socket buffer size
  json_parser_depth: 32      # Maximum JSON nesting depth
  enable_profiling: false    # CPU profiling support
  profile_output: /var/log/goxel/profile
  
  # Experimental features
  enable_compression: false  # Compress large responses
  compression_threshold: 4096 # Bytes
  
  # Debugging
  debug_mode: false         # Enable debug features
  trace_requests: false     # Detailed request tracing

# Environment-specific overrides
environments:
  development:
    daemon:
      worker_threads: 2
    logging:
      log_level: debug
      log_requests: true
      
  production:
    daemon:
      worker_threads: 8
    logging:
      log_level: warn
      log_requests: false
    security:
      enable_rate_limit: true